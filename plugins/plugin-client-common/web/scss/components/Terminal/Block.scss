/*
 * Copyright 2020 IBM Corporation
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

@import '_mixins';
@import '../Sidecar/_mixins';

/** Inset of the <input> element w.r.t. the bordered/backgrounded region */
$inset: 0.375rem;

/** Padding for action buttons */
$action-padding: 3px;

.repl-input,
.repl-input-sourceref,
.repl-output {
  padding-right: calc(1rem - 6px);
}

/** Coloring the context border by status of the block */
@include Scrollback {
  .repl-block {
    position: relative;

    &:before {
      background-color: var(--color-table-border2);
      border-left: none;
      border-right: none;
      border-radius: 1px;
      opacity: 0.5;
      content: '';
      left: 0;
      position: absolute;
      top: 0.1875rem;
      bottom: 0.1875rem;
      width: 5px;
      border-top-right-radius: 1px;
      border-bottom-right-radius: 1px;
    }
    &[data-is-output-only]:not([data-is-focused]):before {
      background-color: transparent;
    }
    &:not([data-is-output-only]) .repl-output {
      margin-top: $inset;
    }
    &[data-is-focused]:before {
      opacity: 1;
    }
    &[data-is-focused]:before,
    &:hover:before {
      background-color: var(--color-brand-01);
    }
    &.error:before {
      opacity: 1;
      background-color: var(--color-error);
    }
    &[data-is-focused] .repl-context {
      opacity: 1;
    }
    &:hover .repl-output .repl-context:after {
      border-color: var(--color-base03);
    }
  }

  .repl-block {
    padding: 0.5rem 0;
    display: flex;
    flex-direction: column;

    &[data-is-quietly-elsewhere] {
      padding-top: 0;
      repl-output {
        margin-top: 0;
      }
    }

    .kui--block-action {
      display: flex;
      padding: $action-padding;
      color: var(--color-text-01);

      /* This is a bit of a hack for TwoFaceIcon, to work around the Checkmark being narrower than other icons in Carbon */
      svg {
        fill: currentColor;
        min-width: 1rem;
      }

      .green-text {
        color: var(--color-ok);
      }
      .red-text {
        color: var(--color-error);
      }
      .yellow-text {
        color: var(--color-warning);
      }
    }

    .kui-block-actions-others {
      display: flex;
      border-right: 1px solid var(--color-table-border2);
    }

    .repl-input .kui--block-action:hover {
      background-color: var(--color-base04);
    }
    .repl-output .kui--block-action:hover {
      background-color: var(--color-table-border3);
    }

    .repl-input,
    .repl-input-sourceref,
    .repl-output {
      padding-left: 1rem;
    }
    .repl-input .kui--toolbar-button-with-icon {
      /* have buttons fit inside the input region */
      height: 1.125rem;
    }
    .repl-context {
      color: var(--color-text-02);
      display: flex;
      justify-content: flex-end;
      flex-basis: 3rem;
      text-align: end;
      margin-right: 0.5rem;
      position: relative;
      opacity: 0.75;
    }
    &:not([data-is-focused]) {
      .repl-context:hover,
      .repl-input-element:hover {
        cursor: pointer;
      }
    }

    .repl-input .repl-context:before {
      left: -1rem !important;
    }

    &:not(.repl-active) {
      .repl-input {
        .repl-context {
          padding-top: $inset;
        }
      }
      .repl-input-element-wrapper {
        border: 1px solid transparent;
        align-items: stretch;
        padding-left: 0.5rem;
        .repl-input-element {
          padding: $inset 0;
        }
      }
    }
    &:not(.repl-active) {
      .repl-input-element-wrapper {
        background-color: $input-bg;
        border-color: $input-border;
      }
    }
    .repl-output .repl-context {
      opacity: 0;
    }

    &[data-is-output-only] .repl-result .kui--card {
      padding: 0;
      background: none;
      box-shadow: none;
      .kui--card-body {
        padding: 0;
      }
    }

    .kui--repl-result-else {
      font-size: 0.75rem;
      font-family: var(--font-sans-serif);
      &,
      a {
        color: var(--color-text-02);
      }
      a {
        font-weight: bold;
      }
    }
  }
  .kui--repl-block-right-element {
    color: var(--color-text-02);
    font-size: 0.625rem;
  }
}

@include sidecar-visible {
  @include Scrollback {
    .repl-context {
      display: none;
    }
  }
}

/* timestamp */
.repl-block {
  .kui--repl-block-timestamp {
    margin: 0 0.5rem;
    display: flex;
    align-items: center;
  }
}
@include sidecar-visible {
  /* timestamp when sidecar is visible */
  .kui--repl-block-timestamp {
    /* hide repl timestamp  */
    display: none;
  }
}
